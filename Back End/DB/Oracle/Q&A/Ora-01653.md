# Ora-01653无法扩展表空间

查询表空间占用大小以及使用情况：

```sql
SELECT UPPER(F.TABLESPACE_NAME) tablespace_name,
D.TOT_GROOTTE_MB tablespace_max,
D.TOT_GROOTTE_MB - F.TOTAL_BYTES usage_tablespace,
TO_CHAR(ROUND((D.TOT_GROOTTE_MB - F.TOTAL_BYTES) / D.TOT_GROOTTE_MB * 100,2),'990.99') usage_percent,
F.TOTAL_BYTES,
F.MAX_BYTES
FROM (SELECT TABLESPACE_NAME,
ROUND(SUM(BYTES) / (1024 * 1024), 2) TOTAL_BYTES,
ROUND(MAX(BYTES) / (1024 * 1024), 2) MAX_BYTES
FROM SYS.DBA_FREE_SPACE
GROUP BY TABLESPACE_NAME) F,
(SELECT DD.TABLESPACE_NAME,
ROUND(SUM(DD.BYTES) / (1024 * 1024), 2) TOT_GROOTTE_MB
FROM SYS.DBA_DATA_FILES DD
GROUP BY DD.TABLESPACE_NAME) D
WHERE D.TABLESPACE_NAME = F.TABLESPACE_NAME
ORDER BY 4 DESC;
```

查看表空间是否开启了自动扩展的功能：

```sql
SELECT T.TABLESPACE_NAME,D.FILE_NAME,D.AUTOEXTENSIBLE,D.BYTES,D.MAXBYTES,D.STATUS
FROM DBA_TABLESPACES T,DBA_DATA_FILES D
WHERE T.TABLESPACE_NAME =D.TABLESPACE_NAME
ORDER BY TABLESPACE_NAME,FILE_NAME;
```

## 综合上述检查结果，可断定遇到的问题是因为表空间不足导致。解决办法也就是扩大表空间：

扩大表空间的四种方法
1、增加数据文件

```sql
ALTER TABLESPACE ***_TRD ADD DATAFILE
'D:\ORACLE\PRODUCT\10.2.0\ORADATA\DBFILE\TRD_2.DBF' SIZE 1024M;
```

2、增加数据文件并允许自动增长

```sql
ALTER TABLESPACE ***_TRD ADD DATAFILE
'D:\ORACLE\PRODUCT\10.2.0\ORADATA\DBFILE\TRD_2.DBF' SIZE 1024M AUTOEXTEND ON NEXT 8M MAXSIZE 10240M;
```

3、允许已存在的数据文件自动增长

```sql
ALTER DATABASE DATAFILE 'D:\ORACLE\PRODUCT\10.2.0\ORADATA\DBFILE\TRD.DBF'
AUTOEXTEND ON NEXT 8M MAXSIZE 10240M;
```

4、手工改变已存在数据文件的大小

```sql
ALTER DATABASE DATAFILE 'D:\ORACLE\PRODUCT\10.2.0\ORADATA\DBFILE\TRD.DBF'
RESIZE 10240M;
```